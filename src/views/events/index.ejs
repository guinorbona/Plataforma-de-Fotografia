<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<main class="container">
  <div class="section-header">
    <h1><%= isAdmin ? 'Todos os Eventos' : 'Meus Eventos' %></h1>
    <a href="/eventos/novo" class="btn btn-primary">Novo Evento</a>
  </div>

  <form method="GET" class="form-card" style="margin-bottom: 1rem;">
    <div class="form-group">
      <label for="search">Nome do evento</label>
      <input
        type="text"
        id="search"
        name="search"
        value="<%= filters && filters.search ? filters.search : '' %>"
        placeholder="Buscar pelo nome..."
      />
    </div>

    <div class="form-group">
      <label for="date">Data do evento</label>
      <% const today = new Date().toISOString().split('T')[0]; %>
      <input
        type="date"
        id="date"
        name="date"
        min="1900-01-01"
        max="<%= today %>"
        value="<%= filters && filters.date ? filters.date : '' %>"
      />
    </div>

    <% if (isAdmin) { %>
      <div class="form-group">
        <label for="clientName">Cliente</label>
        <input
          type="text"
          id="clientName"
          name="clientName"
          value="<%= filters && filters.clientName ? filters.clientName : '' %>"
          placeholder="Nome do cliente..."
        />
      </div>
    <% } %>

    <button type="submit" class="btn btn-primary btn-small">Filtrar</button>
    <a href="/eventos" class="btn btn-outline btn-small">Limpar</a>
  </form>

  <% if (eventos && eventos.length) { %>
    <table class="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Data</th>
          <th class="actions-col">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% eventos.forEach(e => { %>
          <tr>
            <td><%= e.eventName %></td>
            <td><%= e.eventDate %></td>
            <td class="actions-col">
              <a href="/galeria/<%= e.id %>" class="btn btn-secondary btn-small">Galeria</a>
              <a href="/eventos/<%= e.id %>/editar" class="btn btn-outline btn-small">Editar</a>
              <form action="/eventos/<%= e.id %>/excluir" method="POST" class="inline-form" onsubmit="return confirm('Tem certeza que deseja excluir este evento?');">
                <button type="submit" class="btn btn-danger btn-small">Excluir</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>Você ainda não possui eventos cadastrados.</p>
  <% } %>
</main>

<%- include('../partials/footer') %>
